name: Generate changelog

on:
  release:
    types: [created, edited]

jobs:
  generate-changelog:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # Necesario para que la Action vea todo el historial
          fetch-depth: 0

      - name: Generate CHANGELOG and open PR
        uses: BobAnkh/auto-generate-changelog@v1.3.0
        with:
          # Si se omite, usa el repositorio actual. Aquí se deja explícito:
          REPO_NAME: "mjanez/spain-cultural-pulse"
          ACCESS_TOKEN: ${{ secrets.GITHUB_TOKEN }}

          # Fichero de changelog
          PATH: "CHANGELOG.md"

          # Rama donde se actualiza el changelog (se creará si no existe)
          # Se recomienda incluir el número de versión en el nombre
          BRANCH: "chore/changelog-${{ github.event.release.tag_name }}"

          # Rama base donde se quiere mergear el changelog (main en este flujo)
          PULL_REQUEST: "main"

          # Mensaje de commit que añadirá la Action en la rama BRANCH
          COMMIT_MESSAGE: "docs(CHANGELOG): update release notes for ${{ github.event.release.tag_name }}"

          # Mapeo de tipos de commit -> secciones del changelog
          TYPE: "feat:Features,fix:Bug Fixes,docs:Documentation,refactor:Refactor,perf:Performance Improvements,chore:Chores"

          # Scope por defecto para commits sin scope
          DEFAULT_SCOPE: "general"

          # Incluir commits no asociados aún a releases (opcional)
          UNRELEASED_COMMITS: true

          # Regenerar sólo los releases nuevos (0) o más si se necesita
          REGENERATE_COUNT: 0